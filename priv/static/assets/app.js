(()=>{var X=11;function ae(e,t){var r=t.attributes,n,i,s,u,m;if(!(t.nodeType===X||e.nodeType===X)){for(var b=r.length-1;b>=0;b--)n=r[b],i=n.name,s=n.namespaceURI,u=n.value,s?(i=n.localName||i,m=e.getAttributeNS(s,i),m!==u&&(n.prefix==="xmlns"&&(i=n.name),e.setAttributeNS(s,i,u))):(m=e.getAttribute(i),m!==u&&e.setAttribute(i,u));for(var S=e.attributes,w=S.length-1;w>=0;w--)n=S[w],i=n.name,s=n.namespaceURI,s?(i=n.localName||i,t.hasAttributeNS(s,i)||e.removeAttributeNS(s,i)):t.hasAttribute(i)||e.removeAttribute(i)}}var U,oe="http://www.w3.org/1999/xhtml",f=typeof document>"u"?void 0:document,se=!!f&&"content"in f.createElement("template"),le=!!f&&f.createRange&&"createContextualFragment"in f.createRange();function ce(e){var t=f.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}function de(e){U||(U=f.createRange(),U.selectNode(f.body));var t=U.createContextualFragment(e);return t.childNodes[0]}function ue(e){var t=f.createElement("body");return t.innerHTML=e,t.childNodes[0]}function he(e){return e=e.trim(),se?ce(e):le?de(e):ue(e)}function x(e,t){var r=e.nodeName,n=t.nodeName,i,s;return r===n?!0:(i=r.charCodeAt(0),s=n.charCodeAt(0),i<=90&&s>=97?r===n.toUpperCase():s<=90&&i>=97?n===r.toUpperCase():!1)}function fe(e,t){return!t||t===oe?f.createElement(e):f.createElementNS(t,e)}function pe(e,t){for(var r=e.firstChild;r;){var n=r.nextSibling;t.appendChild(r),r=n}return t}function W(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r))}var G={OPTION:function(e,t){var r=e.parentNode;if(r){var n=r.nodeName.toUpperCase();n==="OPTGROUP"&&(r=r.parentNode,n=r&&r.nodeName.toUpperCase()),n==="SELECT"&&!r.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),r.selectedIndex=-1)}W(e,t,"selected")},INPUT:function(e,t){W(e,t,"checked"),W(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var n=e.firstChild;if(n){var i=n.nodeValue;if(i==r||!r&&i==e.placeholder)return;n.nodeValue=r}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var r=-1,n=0,i=e.firstChild,s,u;i;)if(u=i.nodeName&&i.nodeName.toUpperCase(),u==="OPTGROUP")s=i,i=s.firstChild,i||(i=s.nextSibling,s=null);else{if(u==="OPTION"){if(i.hasAttribute("selected")){r=n;break}n++}i=i.nextSibling,!i&&s&&(i=s.nextSibling,s=null)}e.selectedIndex=r}}},E=1,K=11,Y=3,Q=8;function y(){}function me(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function ge(e){return function(t,r,n){if(n||(n={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var i=r;r=f.createElement("html"),r.innerHTML=i}else r=he(r);else r.nodeType===K&&(r=r.firstElementChild);var s=n.getNodeKey||me,u=n.onBeforeNodeAdded||y,m=n.onNodeAdded||y,b=n.onBeforeElUpdated||y,S=n.onElUpdated||y,w=n.onBeforeNodeDiscarded||y,k=n.onNodeDiscarded||y,ee=n.onBeforeElChildrenUpdated||y,te=n.skipFromChildren||y,B=n.addChild||function(a,o){return a.appendChild(o)},D=n.childrenOnly===!0,A=Object.create(null),z=[];function L(a){z.push(a)}function F(a,o){if(a.nodeType===E)for(var d=a.firstChild;d;){var l=void 0;o&&(l=s(d))?L(l):(k(d),d.firstChild&&F(d,o)),d=d.nextSibling}}function M(a,o,d){w(a)!==!1&&(o&&o.removeChild(a),k(a),F(a,d))}function O(a){if(a.nodeType===E||a.nodeType===K)for(var o=a.firstChild;o;){var d=s(o);d&&(A[d]=o),O(o),o=o.nextSibling}}O(t);function $(a){m(a);for(var o=a.firstChild;o;){var d=o.nextSibling,l=s(o);if(l){var c=A[l];c&&x(o,c)?(o.parentNode.replaceChild(c,o),I(c,o)):$(o)}else $(o);o=d}}function re(a,o,d){for(;o;){var l=o.nextSibling;(d=s(o))?L(d):M(o,a,!0),o=l}}function I(a,o,d){var l=s(o);if(l&&delete A[l],!d){var c=b(a,o);if(c===!1||(c instanceof HTMLElement&&(a=c,O(a)),e(a,o),S(a),ee(a,o)===!1))return}a.nodeName!=="TEXTAREA"?ne(a,o):G.TEXTAREA(a,o)}function ne(a,o){var d=te(a,o),l=o.firstChild,c=a.firstChild,N,p,T,H,g;e:for(;l;){for(H=l.nextSibling,N=s(l);!d&&c;){if(T=c.nextSibling,l.isSameNode&&l.isSameNode(c)){l=H,c=T;continue e}p=s(c);var P=c.nodeType,v=void 0;if(P===l.nodeType&&(P===E?(N?N!==p&&((g=A[N])?T===g?v=!1:(a.insertBefore(g,c),p?L(p):M(c,a,!0),c=g,p=s(c)):v=!1):p&&(v=!1),v=v!==!1&&x(c,l),v&&I(c,l)):(P===Y||P==Q)&&(v=!0,c.nodeValue!==l.nodeValue&&(c.nodeValue=l.nodeValue))),v){l=H,c=T;continue e}p?L(p):M(c,a,!0),c=T}if(N&&(g=A[N])&&x(g,l))d||B(a,g),I(g,l);else{var _=u(l);_!==!1&&(_&&(l=_),l.actualize&&(l=l.actualize(a.ownerDocument||f)),B(a,l),$(l))}l=H,c=T}re(a,c,p);var q=G[a.nodeName];q&&q(a,o)}var h=t,R=h.nodeType,J=r.nodeType;if(!D){if(R===E)J===E?x(t,r)||(k(t),h=pe(t,fe(r.nodeName,r.namespaceURI))):h=r;else if(R===Y||R===Q){if(J===R)return h.nodeValue!==r.nodeValue&&(h.nodeValue=r.nodeValue),h;h=r}}if(h===r)k(t);else{if(r.isSameNode&&r.isSameNode(h))return;if(I(h,r,D),z)for(var j=0,ie=z.length;j<ie;j++){var V=A[z[j]];V&&M(V,V.parentNode,!1)}}return!D&&h!==t&&t.parentNode&&(h.actualize&&(h=h.actualize(t.ownerDocument||f)),t.parentNode.replaceChild(h,t)),h}}var ve=ge(ae),ye=ve,be=class{constructor(){this.structure=new Map}initialize(e){this.structure=new Map(Object.entries(JSON.parse(JSON.stringify(e))))}applyDiff(e,t){if(t?.type==="stateful"){this.structure.set(t.id,t);return}if(!this.structure.has(e)){let r=String(e).replace(/\r|\n/g,"");console.warn(`[Arizona] StatefulId '${r}' not found in structure`)}for(let[r,n]of t)if(n&&typeof n=="object"&&n.type)this.structure.get(e).dynamic[r-1]=n;else if(Array.isArray(n)){let i=this.structure.get(e).dynamic[r-1];i&&i.type==="list"?this.structure.get(e).dynamic[r-1].dynamic=n:i&&i.type==="stateless"?n.forEach(([s,u])=>{this.structure.get(e).dynamic[r-1].dynamic[s-1]=u}):this.structure.get(e).dynamic[r-1]=n}else this.structure.get(e).dynamic[r-1]=n}generateStatefulHTML(e){let t=this.structure.get(e);if(!t){let r=String(e).replace(/\r|\n/g,"");console.warn(`[Arizona] StatefulId '${r}' not found in structure`)}return this.zipStaticDynamic(t.static,t.dynamic)}generateStatelessHTML(e){return this.zipStaticDynamic(e.static,e.dynamic)}generateListHTML(e){let{static:t,dynamic:r}=e;return r.reduce((n,i)=>n+this.zipStaticDynamic(t,i),"")}zipStaticDynamic(e,t){let r=[],n=Math.max(e.length,t.length);for(let i=0;i<n;i++)i<e.length&&r.push(e[i]),i<t.length&&r.push(this.normalizeDynamicElement(t[i]));return r.join("")}normalizeDynamicElement(e){return typeof e=="string"?e:e&&e.type==="stateful"?this.generateStatefulHTML(e.id):e&&e.type==="stateless"?this.generateStatelessHTML(e):e&&e.type==="list"?this.generateListHTML(e):Array.isArray(e)?this.flattenIoData(e):String(e)}flattenIoData(e){return typeof e=="string"?e:typeof e=="number"?String(e):Array.isArray(e)?e.map(t=>this.flattenIoData(t)).join(""):e&&typeof e=="object"?e.type==="stateful"?this.generateStatefulHTML(e.id):e.type==="stateless"?this.generateStatelessHTML(e):e.type==="list"?this.generateListHTML(e):String(e):String(e||"")}getStructure(){return JSON.parse(JSON.stringify(Object.fromEntries(this.structure)))}isInitialized(){return this.structure.size>0}getComponentIds(){return Array.from(this.structure.keys())}clear(){this.structure=new Map}createPatch(e){return{type:"html_patch",statefulId:e,html:this.generateStatefulHTML(e)}}createInitialPatch(e){return{type:"initial_render",statefulId:e,html:this.generateStatefulHTML(e)}}},we=be,C={silent:-1,error:3,warning:4,info:6,debug:7},Z=class{constructor(e={}){this.worker=null,this.connected=!1,this.hierarchical=new we,this.logLevel=C[e.logLevel]??C.silent}connect(e={}){if(this.connected)return;let t=e.wsPath||"/live",r=e.workerPath||"/assets/js/arizona-worker.min.js";this.worker=new Worker(r,{type:"module"});let n=window.location.protocol==="https:"?"wss:":"ws:",i=window.location.host,s=window.location.pathname,u=window.location.search,m=encodeURIComponent(s),b=u?encodeURIComponent(u.substring(1)):"",S=`${n}//${i}${t}?path=${m}&qs=${b}`;this.worker.postMessage({type:"connect",data:{url:S}}),this.worker.onmessage=w=>{this.handleWorkerMessage(w.data)}}sendEvent(e,t={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",event:e,params:t}})}sendEventTo(e,t,r={}){this.connected&&this.worker.postMessage({type:"send",data:{type:"event",stateful_id:e,event:t,params:r}})}disconnect(){this.worker&&(this.worker.terminate(),this.worker=null),this.connected=!1,this.hierarchical.clear()}handleWorkerMessage(e){let{type:t,data:r}=e;try{switch(t){case"status":this.handleStatus(r);break;case"html_patch":this.handleHtmlPatch(r);break;case"error":this.handleWorkerError(r);break;case"reload":this.handleReload(r);break;case"reply":this.handleReply(r);break;case"redirect":this.handleRedirect(r);break;default:this.handleUnknownMessage(e)}}catch(n){this.error("Error handling worker message:",n)}}handleStatus(e){e.status==="connected"?(this.connected=!0,this.info("Connected to WebSocket")):e.status==="disconnected"&&(this.connected=!1,this.info("Disconnected from WebSocket")),this.dispatchArizonaEvent("status",e)}handleHtmlPatch(e){let{patch:t,isInitial:r}=e;r?this.handleInitialRender(t):this.handleDiffPatch(t)}handleInitialRender(e){this.debug("Applying initial render"),e.structure&&this.hierarchical.initialize(e.structure),this.applyHtmlPatch(e)}handleDiffPatch(e){this.debug("Applying diff patch"),this.applyHtmlPatch(e)}applyHtmlPatch(e){let t=document.getElementById(e.statefulId);if(!t){this.warning(`Target element not found: ${e.statefulId}`);return}try{ye(t,e.html,{onBeforeElUpdated(r,n){return!r.isEqualNode(n)}}),this.debug("Patch applied successfully"),t.dispatchEvent(new CustomEvent("arizona:patched",{detail:{patch:e}}))}catch(r){this.error("Error applying HTML patch:",r)}}handleWorkerError(e){this.error("Worker Error:",e.error),this.dispatchArizonaEvent("error",e)}handleReload(e){switch(e.file_type){case"css":this.info("CSS file changed. Refreshing stylesheets without page reload..."),document.querySelectorAll('link[rel="stylesheet"]').forEach(t=>{let r=t.href.split("?")[0];t.href=`${r}?t=${Date.now()}`});break;default:this.info(`${e.file_type||"File"} changed. Reloading page...`),window.location.reload()}}handleReply(e){this.debug("WebSocket reply:",e),this.dispatchArizonaEvent("reply",e)}handleRedirect(e){this.info("Redirecting to:",e.url),this.dispatchArizonaEvent("redirect",e),window.open(e.url,e.options?.target,e.options?.window_features)}handleUnknownMessage(e){this.warning("Unknown worker message:",e)}dispatchArizonaEvent(e,t){document.dispatchEvent(new CustomEvent("arizonaEvent",{detail:{type:e,data:t}}))}isConnected(){return this.connected}error(e,...t){console.error(`[Arizona] ${e}`,...t)}warning(e,...t){this.logLevel>=C.warning&&console.warn(`[Arizona] ${e}`,...t)}info(e,...t){this.logLevel>=C.info&&console.log(`[Arizona] ${e}`,...t)}debug(e,...t){this.logLevel>=C.debug&&console.log(`[Arizona] ${e}`,...t)}};globalThis.arizona=new Z({logLevel:"debug"});arizona.connect({wsPath:"/live"});})();
